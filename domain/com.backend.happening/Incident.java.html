<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>Incident.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">code-coverage</a> &gt; <a href="../index.html" class="el_bundle">domain</a> &gt; <a href="index.source.html" class="el_package">com.backend.happening</a> &gt; <span class="el_source">Incident.java</span></div><h1>Incident.java</h1><pre class="source lang-java linenums">package com.backend.happening;

import com.backend.shared.Location;
import com.backend.user.Comment;
import com.backend.user.User;
import lombok.Builder;
import lombok.NonNull;

import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

/**
 * Reprezintă o întâmplare de tip incident raportată de un utilizator.
 * Fiecare incident are un titlu, o descriere, locație, autor, timp de expirare și statistici de reacții.
 */
<span class="pc bpc" id="L18" title="5 of 10 branches missed.">@Builder(toBuilder = true)</span>
public record Incident(
<span class="pc bpc" id="L20" title="1 of 2 branches missed.">        @NonNull UUID id,</span>
<span class="pc bpc" id="L21" title="1 of 2 branches missed.">        @NonNull String title,</span>
<span class="pc bpc" id="L22" title="1 of 2 branches missed.">        @NonNull String description,</span>
<span class="pc bpc" id="L23" title="1 of 2 branches missed.">        @NonNull User user,</span>
<span class="pc bpc" id="L24" title="1 of 2 branches missed.">        @NonNull Location location,</span>
        LocalDateTime createdAt,
        LocalDateTime expirationTime,
        List&lt;Comment&gt; comments,
        int likes,
        int dislikes,
        int confirms,
        int denies,
        int consecutiveDenies
) implements Happening{

    /**
     * Constructor cu validări interne pentru titlu, descriere, reacții și timp.
     */
<span class="fc" id="L38">    public Incident {</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">        if (title.length() &lt; 10)</span>
<span class="fc" id="L40">            throw new IllegalArgumentException(&quot;Title too short.&quot;);</span>

<span class="fc bfc" id="L42" title="All 2 branches covered.">        if (description.length() &lt; 20)</span>
<span class="fc" id="L43">            throw new IllegalArgumentException(&quot;Description too short.&quot;);</span>

<span class="fc bfc" id="L45" title="All 10 branches covered.">        if (likes &lt; 0 || dislikes &lt; 0 || confirms &lt; 0 || denies &lt; 0 || consecutiveDenies &lt; 0) {</span>
<span class="fc" id="L46">            throw new IllegalArgumentException(&quot;Negative values not allowed.&quot;);</span>
        }

<span class="fc bfc" id="L49" title="All 2 branches covered.">        if (createdAt == null)</span>
<span class="fc" id="L50">            createdAt = LocalDateTime.now();</span>

        // Setăm timp de expirare implicit dacă nu este specificat
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (expirationTime == null)</span>
<span class="fc" id="L54">            expirationTime = createdAt.plusMinutes(30);</span>

<span class="fc bfc" id="L56" title="All 2 branches covered.">        if (expirationTime.isBefore(createdAt)) {</span>
<span class="fc" id="L57">            throw new IllegalArgumentException(&quot;Expiration time cannot be before createdAt.&quot;);</span>
        }
<span class="fc bfc" id="L59" title="All 2 branches covered.">        if (expirationTime.isBefore(LocalDateTime.now())) {</span>
<span class="fc" id="L60">            throw new IllegalArgumentException(&quot;Expiration time cannot be before now.&quot;);</span>
        }

<span class="fc bfc" id="L63" title="All 2 branches covered.">        comments = comments == null ? List.of() : new ArrayList&lt;&gt;(comments);</span>

<span class="fc" id="L65">    }</span>

    /**
     * Verifică dacă incidentul trebuie șters.
     * Se consideră valid pentru ștergere dacă a expirat sau are 3 sau mai multe deny-uri consecutive.
     *
     * @return true dacă trebuie șters, altfel false
     */
    public boolean shouldBeDeleted() {
<span class="pc bpc" id="L74" title="3 of 4 branches missed.">            return consecutiveDenies &gt;=3 || isExpired();</span>
        }

    /**
     * Verifică dacă incidentul ar trebui șters la un moment dat specific.
     *
     * @param now momentul curent
     * @return true dacă are 3 sau mai multe deny-uri consecutive sau a expirat până la acel moment
     */
    public boolean shouldBeDeleted(LocalDateTime now) {
<span class="pc bpc" id="L84" title="1 of 4 branches missed.">        return consecutiveDenies &gt;= 3 || isExpired(now);</span>
    }

    /**
     * Adaugă o confirmare și extinde timpul de expirare cu 5 minute. Resetează deny-urile consecutive.
     *
     * @return noul obiect Incident actualizat
     */
    public Incident addConfirm() {
<span class="fc" id="L93">        return this.toBuilder()</span>
<span class="fc" id="L94">                .confirms(confirms + 1)</span>
<span class="fc" id="L95">                .expirationTime(expirationTime.plusMinutes(5))</span>
<span class="fc" id="L96">                .consecutiveDenies(0)</span>
<span class="fc" id="L97">                .build();</span>
    }

    /**
     * Adaugă un deny și crește contorul de deny-uri consecutive.
     *
     * @return noul obiect Incident actualizat
     */
    public Incident addDeny() {
<span class="fc" id="L106">        return this.toBuilder()</span>
<span class="fc" id="L107">                .denies(denies + 1)</span>
<span class="fc" id="L108">                .consecutiveDenies(consecutiveDenies + 1)</span>
<span class="fc" id="L109">                .build();</span>
    }

    /**
     * Verifică dacă incidentul a expirat în raport cu timpul actual.
     *
     * @return true dacă timpul curent este după expirationTime
     */
    public boolean isExpired() {
<span class="nc" id="L118">        return LocalDateTime.now().isAfter(expirationTime);</span>
    }

    /**
     * Verifică dacă incidentul a expirat în raport cu un timp dat.
     *
     * @param now timpul de comparație
     * @return true dacă now este după expirationTime
     */
    public boolean isExpired(LocalDateTime now) {
<span class="fc" id="L128">        return now.isAfter(expirationTime);</span>
    }

    /**
     * Creează o copie a incidentului cu un număr actualizat de like-uri.
     *
     * @param likes noul număr de like-uri
     * @return noul obiect Incident
     */
    @Override
    public Happening withLikes(int likes) {
<span class="fc" id="L139">        return this.toBuilder()</span>
<span class="fc" id="L140">                .likes(likes)</span>
<span class="fc" id="L141">                .build();</span>
    }

    /**
     * Creează o copie a incidentului cu un număr actualizat de dislike-uri.
     *
     * @param dislikes noul număr de dislike-uri
     * @return noul obiect Incident
     */
    @Override
    public Happening withDislikes(int dislikes) {
<span class="fc" id="L152">        return this.toBuilder()</span>
<span class="fc" id="L153">                .dislikes(dislikes)</span>
<span class="fc" id="L154">                .build();</span>
    }

    /**
     * Creează o copie a incidentului cu lista de comentarii actualizată.
     *
     * @param comments lista nouă de comentarii
     * @return noul obiect Incident
     */
    @Override
    public Happening withComments(List&lt;Comment&gt; comments) {
<span class="fc" id="L165">        return  this.toBuilder()</span>
<span class="fc" id="L166">                .comments(comments)</span>
<span class="fc" id="L167">                .build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>